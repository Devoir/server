var app=angular.module("app",["controllers"]);$(document).ready(function(){function addCourse(){var eventlist=[];if(2!=courses.length){var calendarId="https://learningsuite.byu.edu/iCalFeed/ical.php?courseID=HD832sKIIdzI";1==courses.length&&(calendarId="https://learningsuite.byu.edu/iCalFeed/ical.php?courseID=AJRz4eKuTIIY");var courseId=5;$.ajax({type:"POST",url:"/api/courses/"+courseId+"/tasks/import",data:{icalFeed:calendarId},success:function(data1){for(var d in data1)eventlist.push({title:data1[d].description,start:data1[d].start_date,allDay:!1,completed:!1});var Color="#44B8EA";1==courses.length&&(Color="#F77C36"),console.log("course populated");var n="Course "+courses.length,course={color:Color,textColor:"black",courseName:n,events:eventlist,id:courses.length,visible:!0};courseBeingLoaded=course,getCourseName(course)},error:function(){alert("Course Failed to Load")}})}}function getCourseName(){$("#loading").css("visibility","hidden"),$("#nameCourseDialog").css("visibility","visible"),$("#modalBackground").css("opacity","0.5")}function addCourseToList(course){var div=document.createElement("DIV"),id="course"+course.id;div.id=id,div.title=course.id,div.className="course",div.style.backgroundColor=course.color,div.style.paddingLeft="5px";var t=document.createTextNode(course.courseName),box=document.createElement("INPUT");box.setAttribute("type","checkbox"),box.setAttribute("checked",!0),box.id="checkbox",box.style.float="right",div.appendChild(t),div.appendChild(box),$("#loadedcourses").append(div)}function displayTaskDetails(calEvent,jsEvent){$("#taskDetailsDialog").css("visibility","visible");var str='<h3 style="text-align:center">'+calEvent.source.courseName+"</h3>";str+="<p>"+calEvent.title+"</p>",$("#taskDetailsDiv").html(str);var width=$("#taskDetailsDialog").css("width"),height=$("#taskDetailsDialog").css("height"),taskX=jsEvent.pageX,taskY=jsEvent.pageY,left=(parseInt(width),parseInt(height),taskX-parseInt(width)+parseInt(width)/2),top=taskY-parseInt(height)-10;$("#taskDetailsDialog").css("top",top),$("#taskDetailsDialog").css("left",left),calEvent.completed?($("#completionButton").removeClass("incomplete").addClass("complete"),$("#completionButton").html("Complete")):($("#completionButton").removeClass("complete").addClass("incomplete"),$("#completionButton").html("Incomplete"))}var courseBeingLoaded,currentTask,courses=[];$("#nameCourseButton").click(function(){var name=$("#courseNameField").val();""==name?alert("Name cannot be empty"):(courseBeingLoaded.courseName=name,$("#courseNameField").val(""),$("#nameCourseDialog").css("visibility","hidden"),$("#modalBackground").css("opacity","0"),addCourseToList(courseBeingLoaded),$("#calendar").fullCalendar("addEventSource",courseBeingLoaded),courses.push(courseBeingLoaded))}),$("#loadedcourses").click(function(event){if(console.log("clicked course "+event.target.title),"checkbox"==event.target.type){var id=parseInt(event.target.parentElement.title),course=courses[id];course.visible?($("#calendar").fullCalendar("removeEventSource",course),course.visible=!1):($("#calendar").fullCalendar("addEventSource",course),course.visible=!0)}}),$("#calendar").fullCalendar({header:{left:"prev,next today",center:"title",right:"month,agendaWeek,agendaDay"},editable:!0,eventLimit:!0,selectable:!0,selectHelper:!0,eventSources:[],eventClick:function(calEvent,jsEvent){currentTask=calEvent,displayTaskDetails(calEvent,jsEvent)}}),$("#completionButton").click(function(){currentTask.completed=!currentTask.completed,currentTask.completed?(currentTask.textColor="green",currentTask.borderColor="green",$("#completionButton").removeClass("incomplete").addClass("complete"),$("#completionButton").html("Complete")):(currentTask.textColor="black",currentTask.borderColor="",$("#completionButton").removeClass("complete").addClass("incomplete"),$("#completionButton").html("Incomplete")),$("#calendar").fullCalendar("rerenderEvents")}),$("#closeDetailsButton").click(function(){$("#taskDetailsDialog").css("visibility","hidden")}),$("#addbutton").click(function(){console.log("add"),$("#addSongDialog").css("visibility","visible"),$("#modalBackground").css("opacity","0.5")}),$("#importCourse").click(function(){$("#addSongDialog").css("visibility","hidden"),$("#loading").css("visibility","visible");addCourse()}),$("#closeAddSongButton").click(function(){$("#addSongDialog").css("visibility","hidden"),$("#modalBackground").css("opacity","0")})});var controllers=controllers||angular.module("controllers",["ui.calendar","ui.bootstrap"]);controllers.controller("calendarCtrl",["$scope","$compile","uiCalendarConfig","$http",function($scope,$compile,uiCalendarConfig,$http){console.log("calendarCtrl loaded");var date=new Date,m=date.getMonth(),y=date.getFullYear();$scope.calendarId="https://learningsuite.byu.edu/iCalFeed/ical.php?courseID=HD832sKIIdzI",$scope.courses=[],$scope.getCalendar=function(){$scope.loadingFeed=!0;var course={color:"#f00",textcolor:"black",events:[]},courseId=5;$http.post("/api/courses/"+courseId+"/tasks/import",{icalFeed:$scope.calendarId}).success(function(data){for(var d in data)course.events.push({title:data[d].description,start:new Date(data[d].start),allDay:!1});course.events.push({title:"All Day Event",start:new Date(y,m,1)}),$scope.courses.push(course),$scope.loadingFeed=!1}).error(function(data,status){$scope.error={data:data,status:status},$scope.loadingFeed=!1})},$scope.events=[],$scope.alertOnEventClick=function(date){$scope.alertMessage=date.title+" was clicked "},$scope.changeView=function(view,calendar){uiCalendarConfig.calendars[calendar].fullCalendar("changeView",view)},$scope.renderCalender=function(calendar){uiCalendarConfig.calendars[calendar]&&uiCalendarConfig.calendars[calendar].fullCalendar("render")},$scope.eventRender=function(event,element){element.attr({tooltip:event.title,"tooltip-append-to-body":!0}),$compile(element)($scope)},$scope.uiConfig={calendar:{height:450,editable:!0,header:{left:"title",center:"",right:"today prev,next"},eventClick:$scope.alertOnEventClick,eventDrop:$scope.alertOnDrop,eventResize:$scope.alertOnResize,eventRender:$scope.eventRender}},$scope.eventSources=[$scope.events,$scope.courses]}]);var controllers=controllers||angular.module("controllers",[]);controllers.controller("homeCtrl",["$scope","$http",function(){console.log("homeCtrl loaded")}]);var controllers=controllers||angular.module("controllers",[]);controllers.controller("taskViewCtrl",["$scope","$http",function($scope,$http){console.log("taskViewCtrl loaded"),$scope.calendarId="https://learningsuite.byu.edu/iCalFeed/ical.php?courseID=HD832sKIIdzI",$scope.getCalendar=function(){$scope.loadingFeed=!0,$scope.events=[];var courseId=5;$http.post("/api/courses/"+courseId+"/tasks/import",{icalFeed:$scope.calendarId}).success(function(data){for(var d in data)$scope.events.push(data[d]);$scope.loadingFeed=!1}).error(function(data,status){$scope.error={data:data,status:status},$scope.loadingFeed=!1}),$http.get("/api/courses/"+courseId+"/tasks/").success(function(data){for(var d in data)$scope.events.push(data[d]);$scope.loadingFeed=!1})},$scope.checkOff=function(event){event.done=!event.done},$scope.courses=[{name:"Course",color:"#ccc"},{name:"Course",color:"#ccc"},{name:"Course",color:"#ccc"},{name:"Course",color:"#ccc"},{name:"Course",color:"#ccc"}]}]);